# Example Controller Configuration
# This file demonstrates advanced configuration options for kube-node-ready controller mode

# Worker Pod Configuration
worker:
  image:
    repository: ghcr.io/imunhatep/kube-node-ready
    tag: "0.3.0"
    pullPolicy: IfNotPresent
  # namespace: kube-system  # Auto-detected from controller environment
  serviceAccountName: "kube-node-ready-worker"
  priorityClassName: "system-node-critical"
  timeoutSeconds: 300  # Overall job timeout

  # Resource configuration for worker pods
  resources:
    requests:
      cpu: "50m"
      memory: "64Mi"
    limits:
      memory: "128Mi"  # CPU limits omitted to avoid throttling

  # Additional tolerations for worker pods
  # Useful when nodes have additional taints beyond verification taints
  tolerations:
    # Tolerate all taints (DaemonSet-like behavior)
    - operator: "Exists"
      effect: ""  # Empty effect means tolerate all effects

    # Or use specific tolerations:
    # - key: "spot-instance"
    #   operator: "Exists"
    #   effect: "NoSchedule"
    # - key: "workload-type"
    #   operator: "Equal"
    #   value: "batch"
    #   effect: "NoExecute"
    #   tolerationSeconds: 300

  # Custom init containers for additional verification checks
  # These run before the main verification container and must all succeed
  initContainers: []

  # Job-specific configuration
  job:
    activeDeadlineSeconds: 300  # 5 minutes timeout
    backoffLimit: 2             # Retry twice on failure
    completions: 1              # Single completion required
    parallelism: 1              # One pod at a time
    # ttlSecondsAfterFinished: 600  # Auto-cleanup after 10 minutes

  configMapName: "kube-node-ready-worker"  # Worker runtime config

# Reconciliation Configuration
reconciliation:
  intervalSeconds: 10      # Check every 10 seconds
  maxRetries: 5           # Retry failed nodes 5 times
  retryBackoff: "exponential"  # Options: exponential, linear

# Node Management Configuration
nodeManagement:
  deleteFailedNodes: false  # Set to true to auto-delete failed nodes (DANGEROUS)

  # Taints that indicate unverified nodes (will be removed on success)
  taints: []
    # Additional taints can be configured:
    #- key: "node-ready/unverified"
    #  value: "true"
    #  effect: "NoSchedule"

  # Label added to verified nodes
  verifiedLabel:
    key: "node-ready/verified"
    value: "true"

# Metrics Configuration
metrics:
  enabled: true
  port: 8080

# Health Configuration
health:
  port: 8081

# Logging Configuration
logging:
  level: "info"     # Options: debug, info, warn, error
  format: "json"    # Options: json, console

# Kubernetes Client Configuration
kubernetes:
  kubeconfigPath: ""  # Empty for in-cluster config
  qps: 50            # API server requests per second
  burst: 100         # Burst requests allowed
